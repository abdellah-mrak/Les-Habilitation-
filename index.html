<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بيانات Google Sheets</title>
</head>
<body>
    <h1>بيانات من Google Sheets</h1>
    <table id="data-table" border="1">
        <thead>
            <tr>
                <th>Matricule</th>
                <th>NomPrénom</th>
                <th>Tel</th>
                <th>Habilitation</th>
            </tr>
        </thead>
        <tbody>
            <!-- البيانات سيتم إدراجها هنا -->
        </tbody>
    </table>

    <script>
        // رابط CSV المنشور من Google Sheets
        const csvUrl = 'https://docs.google.com/spreadsheets/d/13j-_0Z7BVrXv7w4qQczYq3TYCtzkXC_aiFLFjJnioko/pub?output=csv';

        // دالة لجلب بيانات CSV
        async function fetchCSVData(url) {
            const response = await fetch(url);
            const data = await response.text();
            return data;
        }

        // دالة لتحويل CSV إلى JSON
        function csvToJSON(csv) {
            const lines = csv.trim().split("\n");
            const headers = lines[0].split(",");
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const obj = {};
                const currentline = lines[i].split(",");

                if (currentline.length === headers.length) {
                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j].trim()] = currentline[j].trim();
                    }
                    result.push(obj);
                }
            }
            return result;
        }

        // دالة لعرض البيانات في الجدول
        function renderTable(data) {
            const tableBody = document.querySelector('#data-table tbody');
            tableBody.innerHTML = '';

            data.forEach(row => {
                const habilitationValue = row['Habilitation'].trim() !== '' ? row['Habilitation'] : 'لا توجد بيانات';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row['Matricule'] || 'N/A'}</td>
                    <td>${row['NomPrénom'] || 'N/A'}</td>
                    <td>${row['Tel'] || 'N/A'}</td>
                    <td>${habilitationValue}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // دالة لتحميل وعرض البيانات
        async function loadAndDisplayData() {
            const csvData = await fetchCSVData(csvUrl);
            const jsonData = csvToJSON(csvData);
            renderTable(jsonData);
        }

        // تحديث البيانات كل دقيقة (60000 ميلي ثانية)
        setInterval(loadAndDisplayData, 60000);

        // استدعاء الدالة لتحميل البيانات عند تحميل الصفحة
        loadAndDisplayData();
    </script>
</body>
</html>
